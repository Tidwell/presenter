<!DOCTYPE HTML>
<html>
	<head>
		<title>CMS Javascript</title>
		<link rel="stylesheet" type="text/css" href="css/reset.css" /> 
		<link rel="stylesheet" type="text/css" href="css/style.css" /> 
		<link href='http://fonts.googleapis.com/css?family=IM+Fell+French+Canon+SC&v2' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Anonymous+Pro' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="prettify/prettify.css" /> 
		
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript" src="js/hashchange.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
		<script type="text/javascript" src="prettify/prettify.js"></script>
	</head>
  <body onload="prettyPrint();">
	 <!--
	 
	 
    The JS/HTML  CMS Problem
      -lack of global organizational pattern makes it
        >Revealing Module Pattern
          >the end-game in every js design patterns book (as close to the holy grail)
          >yahoo's variation (sandboxed) not necessary
      
      -difficult to reuse great dom components because...
        >write plugins (tinymce, jquery)
          >standalone
          >testable
          >reusable and portable

      -there is lots of very different code doing the same thing 
        >putting data into the DOM (in forms) and ripping it back out to send to the server (databinding)
          >lots of php bloat in templates just to support js functionality
          >even more js to duplicate templating client side
        >duplicating elements
          >MVVM
          >knockout.js (could also use jquery templates)
        >initializing jquery widgets
          >results in nondescript css properties describing js functionality
          >knockout.js binding handlers
            >decouples and promotes reusable widgets
        >ajax
          >data-sources binding posibilities
        >validation
          >jquery validate?  other solutions?
    
    page-level controls
      this wont change, it has to exist as a controller (and using RMP can expose methods and events)


    event communication?
    
    not the problem on the user-frontend, those are all relatively self-contained entities, but maintaining a Consistent method for namespacing utilities on both the cms and user-frontend will ease complexity


    This is expected, and not surprising, but with cleaning up the php` side of things with V2, we have a unique oportunity
    to form a structure around the html/javascript interactions in the cms and save all of us a lot of work.
-->



  <!--
    overall overview
  -->
	<div class="slide">
	  <h2>CMS HTML & Javascript</h2>
    <img src="img/logo-bi.png" />
	  <h3>Organizational Patterns, Reusable DOM Components, Consistent Code Base</h3>
  </div>
	 
  <div class="slide">
    <h3 style="font-size: 30px; line-height: 40px">Current lack of a global organizational pattern makes it difficult to reuse great DOM components, resulting in a glut of very different code doing the same thing.</h3>
  </div>
	 
	 
	 
	 
  <div class="slide">
    <h2>Three Problems</h2>
      <h3 class="animStep">Organizational Patterns</h3>
      <h3 class="animStep">Reusable DOM Components</h3>
      <h3 class="animStep">Consistant Code Base</h3>
  </div>


  <div class="slide">
    <h2>Organizational Pattern Goals</h2>
      <h3 class="animStep">Speaking structural, not creational</h3>
      <h3 class="animStep">Logically organized into a globally-exposed hierarchy</h3>
      <h3 class="animStep">File-based separation of concerns, concatenated for deployment</h3>
  </div>

  <div class="slide">    
      <h2>Organizational Pattern Options</h2>
      <img src="img/books.png" />
      <ul class="animStep">
        <li>Creational Pattern</li>
        <li>Constructor Pattern</li>
        <li>Singleton Pattern</li><!--post v2-->
        <li>Module Pattern</li> <!--the frontend pattern-->
        <li>Yahoo's Sandbox Module Pattern</li><!--only really useful when partial library loading necessary-->
      </ul>  
  </div>
  
  <div class="slide">
      <h2>Revealing Module Pattern</h2>
      <img src="img/grail.png" />
  </div>

  <div class="slide">
      <h2>Revealing Module Pattern Example</h2>
      <pre class="prettyprint lang-js">
        //Immediately-Invoked Function Expression (IIFE)
        myGlobal = (function() {

          var privateVar = '';

          function privateMethod() {

          }

          function publicMethod() {
            privateMethod();
          }

          return {
            set: publicMethod,
            getPrivate: function() { return privateVar; }
          };
        }())
      </pre>
  </div>
  <div class="slide">
        <!--  
            get via different ajax requests, 
            user sets a preference
            single point use to populate ui
        -->
        <h2>Revealing Module Pattern Example</h2>
        <pre class="prettyprint lang-js">
          //IIFE
          (function($,BI,undefined) {

            BI.namespace('userData');
            var names = {},
                preference;

            //sets the user-preferred service to use when getting username
            function setPreference(pref){
              preference = pref;
            }
            //stores the name associated with a service
            function setName(service,name) {
               names[service] = name;
            }
            //gets a name by service, or the prefered name if used with no arg
            function getName(service) {
              return service ? names[service] : names[preference] || '';
            }
            BI.userData = {
                setPreference: setPreference,
                setName: setName,
                getName: getName,
            };
          }(jQuery, BI))
        </pre>
    </div>
    <div class="slide">
        <h2>Revealing Module Pattern Benefits</h2>
        <ul>
          <li>Self contained</li>
          <li>Via namespace, provides single-entry hierarchy</li>
          <li>Usable on CMS and user-frontend</li>
          <li>jQuery plugins use a RMP variant</li>
        </ul>
    </div>
  <div class="slide">
    <h2>Reusable DOM Components</h2>
    <div class="animStep">
      <h3>Solved problem</h3>
      <img src="img/swslarge.gif" />
      <h3>Library Plugins</h3>
      <h3>jquery/tinymce</h3>
    </div>
  </div>
  <div class="slide">
    <h2>Library Plugin Example<br />jQuery</h2>
    <pre class="prettyprint lang-js">
      (function($,BI,undefined){
        var privateSharedVar = '';            
        var privateSharedMethod = function() {};
        
        //plugin "constructor"
        var MyPlugin = function(element, options) {
          //Instance Vars
          this.$el = $(element);
          //Extend the user-defined options with defaults
          this.options = $.extend({}, {defaults: '', options: ''}, options);
          //bind to the dom el, etc
          this.$el.click(function() {})
        };
        
        MyPlugin.prototype.publicMethod = function() {};
        
        //boilerplate
        $.fn.myplugin = function(option) {
          return this.each(function () {
            var $this = $(this),
              data = $this.data('myplugin'),
              options = typeof option == 'object' && option;
            if (!data) {
              $this.data('myplugin', (data = new MyPlugin(this, options)));
            } else if (typeof option == 'string') {
              data[option]();
            }
          });
        };
      }(jQuery,BI));

      //usage
      $('div').myplugin().myplugin('publicMethod')
    </pre>
  </div>
  <div class="slide">
    <h2>Library Plugin Benefits</h2>
      <h3>We're just modifying form field values anyway...</h3>
      <ul class="animStep">
        <li>Decoupled</li>
        <li>Testable</li>
        <li>Reusable and Portable</li>
      </ul>
      <!-- andrei's code already is very very easy to convert to a plugin -->
  </div>

  <div class="slide">
    <h2>Consistent Code Base</h2>
    <h3>Lots of code doing the same thing.</h3>
    <ul>
      <!--putting data into the DOM (in forms) and ripping it back out to send to the server (php template mess)-->
      <li class="animStep">Generating Forms with defaults & data</li>
      <li class="animStep">Duplicating Form Elements</li>
      <li class="animStep">Initializing jQuery Widgets</li>
      <li class="animStep">Ajax</li>
      <li class="animStep">Validation</li>
    </ul>
  </div>

  <div class="slide">
    <h2>Consistant Code Base Options</h2>
    <h3>Is this a solved problem?</h3>
    <div class="listgroup animStep">
    <ul class="nav nav-pills">
      <li>
        <a href="architecture-examples/backbone/index.html" data-source="http://documentcloud.github.com/backbone/" data-content="Backbone.js gives structure to web applications by providing models with key-value binding and custom events, collections with a rich API of enumerable functions, views with declarative event handling, and connects it all to your existing API over a RESTful JSON interface." data-original-title="">Backbone.js</a>
      </li>
      <li class="animStep strike">
        <a href="dependency-examples/backbone_require/index.html" data-source="http://requirejs.org/" data-content="RequireJS is a JavaScript file and module loader. It is optimized for in-browser use, but it can be used in other JavaScript environments, like Rhino and Node. Using a modular script loader like RequireJS will improve the speed and quality of your code." data-original-title="">Backbone.js + RequireJS</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/emberjs/index.html" data-source="http://emberjs.com/" data-content="Ember is a JavaScript framework for creating ambitious web applications that eliminates boilerplate and provides a standard application architecture." data-original-title="">Ember.js</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/javascriptmvc/todo/todo/index.html" data-source="http://javascriptmvc.com/" data-content="JavaScriptMVC is an open-source framework containing the best ideas in jQuery development. It guides you to successfully completed projects by promoting best practices, maintainability, and convention over configuration." data-original-title="">JavaScriptMVC</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/spine/index.html" data-source="http://spinejs.com/" data-content="Spine is a lightweight framework for building JavaScript web applications. Spine gives you an MVC structure and then gets out of your way, allowing you to concentrate on the fun stuff, building awesome web applications." data-original-title="">Spine.js</a>
      </li>
      <li>
        <a href="architecture-examples/knockoutjs/index.html" data-source="http://knockoutjs.com/" data-content="Simplify dynamic JavaScript UIs by applying the Model-View-View Model (MVVM) pattern" data-original-title="">Knockout (MVVM)</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/sammyjs/index.html" data-source="http://sammyjs.org/" data-content="Sammy.js is a tiny JavaScript framework developed to ease the pain and provide a basic structure for developing JavaScript applications." data-original-title="">Sammy.js</a>
      </li>
    </ul>
    <ul class="nav nav-pills">
      <li class="animStep strike">
        <a href="architecture-examples/dojo/index.html" data-source="http://dojotoolkit.org/" data-content="Dojo saves you time and scales with your development process, using web standards as its platform. It’s the toolkit experienced developers turn to for building high quality desktop and mobile web applications." data-original-title="">Dojo</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/closure/index.html" data-source="http://code.google.com/closure/library/" data-content="The Closure Library is a broad, well-tested, modular, and cross-browser JavaScript library. You can pull just what you need from a large set of reusable UI widgets and controls, and from lower-level utilities for DOM manipulation, server communication, animation, data structures, unit testing, rich-text editing, and more." data-original-title="">Closure</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/yuilibrary/index.html" data-source="http://yuilibrary.com/" data-content="YUI's lightweight core and modular architecture make it scalable, fast, and robust. Built by frontend engineers at Yahoo!, YUI powers the most popular websites in the world." data-original-title="">YUILibrary</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/knockback/index.html" data-source="http://kmalakoff.github.com/knockback/" data-content="Knockback.js provides Knockout.js magic for Backbone.js Models and Collections." data-original-title="">Knockback.js</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/angularjs/index.html" data-source="http://angularjs.org/" data-content="What HTML would have been
had it been designed for web apps" data-original-title="">AngularJS</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/angularjs_persistencejs/index.html" data-source="http://persistencejs.org/" data-content="persistence.js is an asynchronous Javascript object-database mapper. It has database-independent abstractions and can therefore easily be ported to new databases." data-original-title="">Angular + PersistenceJS</a>
      </li>
    </ul>
    <ul class="nav nav-pills">
      <li class="animStep strike">
        <a href="architecture-examples/extjs/index.html" data-source="http://www.sencha.com/products/extjs" data-content="Ext JS 4 is the next major advancement in our JavaScript framework. Featuring expanded functionality, plugin-free charting, and a new MVC architecture it's the best Ext JS yet. Create incredible web apps for every browser." data-original-title="">Ext.js</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/broke/index.html" data-source="https://github.com/brokenseal/broke-client" data-content="The Broke Javascript Framework is a porting of the fantastic Django Web Framework on Javascript. It summarizes all the best concepts present in Django like url resolving, decoupling, DRY principle, project-specific settings and a pretty simple template engine. It could be put in the big Javascript MVC frameworks group outside there, but, as Django is, this is more a MTV (Model-Template-View) framework." data-original-title="">Broke.js</a>
      </li>
      <li class="animStep strike">
        <a href="architecture-examples/fidel/index.html" data-source="http://jga.me/blog/2011/06/10/fidel" data-content="Fidel is a small library for building out ui components (widgets, modules, plugins, whatever you want to call them). It looks very similar to backbone.js and spine.js's controller." data-original-title="">Fidel.js</a>
      </li>
      <li class="animStep strike"><a href="architecture-examples/jquery/index.html" data-source="http://jquery.com/" data-content="jQuery is a fast and concise JavaScript Library that simplifies HTML document traversing, event handling, animating, and Ajax interactions for rapid web development. jQuery is designed to change the way that you write JavaScript." data-original-title="">jQuery</a></li>
      <li class="animStep strike"><a href="reference-examples/vanillajs/index.html" data-source="https://developer.mozilla.org/en/JavaScript" data-content="You know JavaScript right? :P" data-original-title="">Vanilla JS</a></li>
    </ul>
    <a href="http://addyosmani.github.com/todomvc/">http://addyosmani.github.com/todomvc/</a>
  </div>
  </div>
  <div>
  </div>

  <div class="slide">
    <h2>Consistent Code Base <br />Backbone vs Knockout</h2>
    <div class="content">
      <table class="comparison">
        <colgroup>    
        <col>    
        <col class="mid">    
        <col>    
        <col class="ref"></colgroup>
      <thead>
        <tr>
          <th>Backbone</th>
          <th>Knockout.js</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="yes">Bullet-proof ORM</td>
          <td class="no">Weak ORM</td>
        </tr>
        <tr>
          <td class="no">Low level DOM maninulation</td>
          <td class="yes">Reduced jQuery effort</td>
        </tr>
        <tr>
          <td class="no">Manual view updating</td>
          <td class="yes">
            <code>data-bind</code>
            based sorcery
          </td>
        </tr>
        <tr>
          <td class="yes">Routing and history support</td>
          <td class="no">No routing</td>
        </tr>
        <tr>
          <td><abbr title="Model/View/Controller">MVC</abbr>
          </td>
          <td> <abbr title="Model/View/ViewModel">MVVM</abbr>
          </td>
        </tr>
        <tr>
          <td>
            Blurred separation between:
            <br>Views | Controllers</td>
          <td>
            Blurred separation between:
            <br>Models | Controllers (ViewModels)</td>
        </tr>
      </tbody>
    </table>
    <a href="http://kmalakoff.github.com/knockback/">http://kmalakoff.github.com/knockback/</a>
    </div>
  </div>
  <div class="slide">
    <h2>Knockout.js Example</h2>
    <iframe src="anotherjsorg/client/index.html" width="1000" height="2000"></iframe>
  </div>
  <div class="slide">
    <h2>Knockout.js Example</h2>
    <iframe src="anotherjsorg/client/index.html?id=123" width="1000" height="2000"></iframe>
  </div>

  <div class="slide">
    <h2>Knockout.js Example <br />Markup</h2>
    <pre class="prettyprint lang-html" style="border: 0; max-width: none;width: 1150px;">
      &lt;h1&gt;Edit Event&lt;/h1&gt;
      &lt;form&gt;
      &lt;h2&gt;Setup and Landing Page&lt;/h2&gt;
        &lt;p&gt;&lt;label&gt;Event Name&lt;/label&gt;&lt;input type=&quot;text&quot;  data-bind=&quot;value: name&quot; /&gt;&lt;/p&gt;
        &lt;p&gt;&lt;label&gt;Tagline Color&lt;/label&gt;&lt;input type=&quot;text&quot; data-bind=&quot;colorpicker: taglineColor,value: taglineColor&quot; /&gt;&lt;/p&gt;
      &lt;h2&gt;Agenda&lt;/h2&gt;
        &lt;p&gt;&lt;label&gt;Agenda Page Content&lt;/label&gt;&lt;textarea rows=&quot;8&quot; cols=&quot;80&quot; data-bind=&quot;tinymce: agenda_content&quot;&gt;&lt;/textarea&gt;
      &lt;h2&gt;Sponsor Right Rail&lt;/h2&gt;
        &lt;div data-bind=&quot;sortable: rightRail&quot;&gt;
          &lt;div class=&quot;sponsor&quot;&gt;
            &lt;p&gt;&lt;label&gt;Section Header:&lt;/label&gt;&lt;input type=&quot;text&quot; data-bind=&quot;value: header&quot; /&gt;&lt;/p&gt;
            &lt;div data-bind=&quot;sortable: {data: logos,connectClass: &#39;imgs&#39;}&quot;&gt;
              &lt;div class=&quot;imgs&quot;&gt;
                &lt;p&gt;&lt;label&gt;Sponsor Logo/Image:&lt;/label&gt;&lt;input type=&quot;text&quot; data-bind=&quot;value: img&quot; /&gt;&lt;/p&gt;
                &lt;p&gt;&lt;label&gt;Sponsor Url:&lt;/label&gt;&lt;input type=&quot;text&quot; data-bind=&quot;value: url&quot; /&gt;&lt;/p&gt;
                &lt;button data-bind=&quot;click: $root.deleteLogo&quot;&gt;-Delete Logo&lt;/button&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;!-- parent is used, because we are nested 2 levels deep inside the viewModel and the method is on the top level--&gt;
            &lt;button data-bind=&quot;click: $parent.addLogo&quot;&gt;+Add Another Logo&lt;/button&gt;
            &lt;button data-bind=&quot;click: $parent.deleteSection&quot;&gt;-Delete Section&lt;/button&gt;
            &lt;hr /&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;button data-bind=&quot;click: addSection&quot;&gt;+Add Another Section&lt;/button&gt;
        &lt;button type=&quot;submit&quot;&gt;Save&lt;/button&gt;
      &lt;/form&gt;
    </pre>
  </div>

  <div class="slide">
    <h2>Knockout.js Example <br />Page-Controller Javascript</h2>
    <pre class="prettyprint lang-js" style="border: 0">
      /*
        Controller for the Events data type
        Dependancy: jquery, jquery.validate, jquery.colorpicker, knockout, base, data, 
                    ko, querystring, plugins/colorpicker
      */
      (function($,ko,BI,undefined) {
        var dataModel, 
              vm;

        // Define operations the UI can impliment.  At runtime, 'this' will be our
        // active knockout View Model (so we are directly modifying the data that is
        // synced with the DOM)
          var operations = {
              addSection: function() {
                //one line, doing same as above
                this.rightRail.push(BI.ko.wrap($.extend(true,{},dataModel.rightRail[0])));
              },
              deleteSection: function(currentlogo, ev) {
                  vm.rightRail.remove(this);
              },
              
              addLogo: function(sectionData) {
                //one line, doing same as above
                this.logos.push(BI.ko.wrap($.extend(true,{},dataModel.rightRail[0].logos[0])))
              },
              deleteLogo: function(currentlogo, ev) {
                  $ev = $(ev.srcElement)
                  var index = $ev.parents('.sponsor').index();
                  vm.rightRail()[index].logos.remove(this);
              },
              save: function() {
            //we delegate to the data module, passing the entire viewModel
                BI.data.save('event', this);
              }
          };

          //Use BI.data to get the data for the page, and the blank template for the events
          //We use Bi.location to grab the event id from the querystring
          BI.data.get({
            type: 'event',
            id: BI.location.qs.get('id'), 
            callback: function(data,blankObj) {
              //store the blank data model so we can use it later in the operations.
              dataModel = blankObj;
              
              //construct a view model with the data that was returned using BI.ko
              var viewModel = BI.ko.constructViewModel({
                data: data,
                dataTemplate: blankObj
              });

              //extend the viewModel with the operations we defined earlier
              $.extend(true,viewModel,operations);

                    vm = viewModel;

              //initialize the knockout DOM bindings
              ko.applyBindings(viewModel);
              $('form').submit(function(e) {vm.save();e.preventDefault()});
            }
          });
       
      }(jQuery, ko, BI))

    </pre>
  </div>
   

  <div class="slide">
    <h2>Knockout.js Benefits</h2>
    <ul>
      <li>Simplistic HTML Templates (could use any template language with a js parser)</li>  
      <li>Databinding and dynamic form updates based on model updates (sorcery!)</li>
      <li>jQuery plugin integration through adapters</li>
      <li>JSON data models that can be provided by the server or defined on a per-controller basis</li>
      <li>Plays nice with third-party validation libraries</li>
      <li>Easy to write custom bindingHandlers to extend library functionality (data-source,anyone?)</li>
    </ul>
  </div>
  <div class="slide">
    <h3 style="font-size: 30px; line-height: 40px">Current lack of a global organizational pattern makes it difficult to reuse great DOM components, resulting in a glut of very different code doing the same thing.</h2>
      <h3 class="animStep">Organizational Patterns</h3>
      <h3 class="animStep">Reusable DOM Components</h3>
      <h3 class="animStep">Consistant Code Base</h3>
  </div>
  <div class="slide">
    <h3 style="font-size: 30px; line-height: 40px">By using the Revealing Module Pattern and writing Library Plugins we can utilize the standardized features of Knockout.js to create a Consistent HTML/JS codebase for the CMS.</h2>
      <h3 class="animStep">Revealing Module Pattern</h3>
      <h3 class="animStep">Library Plugins</h3>
      <h3 class="animStep">Knockout.js</h3>
  </div>
  <div class="slide">
    <h2>Up in the Air</h2>
      <ul>
        <li>Templating</li>
        <li>Validation (Can we Share?)</li>
        <li>Server->Client Data Interchange Format<br/>&nbsp;&nbsp;(JSON,XML,Forms)</li>
      </ul>
  </div>
  <div class="slide">
    <img src="img/ko-logo.png" style="margin: 10px auto"/>

    <h3>Tutorial & Docs<br /><a href="http://knockoutjs.com">http://knockoutjs.com/</a></h3>
    <h3>Standalone Example<br /><a href="https://github.com/Tidwell/anotherjsorg">https://github.com/Tidwell/anotherjsorg</a></h3>
    <h3>Integrated Proof of Concept Example<br /><a href="https://github.com/businessinsider/tbi/tree/aaron-josh-pcp">https://github.com/businessinsider/tbi/tree/aaron-josh-pcp</a></h3>
  </div>

  <ul class="slide_list">

  </ul>
  <button>List</button>
	</body>
</html>